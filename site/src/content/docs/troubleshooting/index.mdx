---
title: Troubleshooting
description: Solutions for common setup, auth, analysis, and import problems.
sidebar:
  order: 0
---

import { Aside, Steps } from '@astrojs/starlight/components';

## Database connection

### "Cannot open database" or "database is locked"

**Cause:** Rekordbox is running and holds an exclusive lock on `master.db`.

**Fix:** Close Rekordbox completely (check for background processes), then restart the MCP server.

### "Failed to open database" or path errors

**Cause:** `REKORDBOX_DB_PATH` is not set and auto-detection failed. This happens when Rekordbox is installed in a non-standard location.

**Fix:** Set `REKORDBOX_DB_PATH` in your MCP host config to the full path of your `master.db`. The default location is `~/Library/Pioneer/rekordbox/master.db`. See [Environment Variables](/reference/environment-variables/) for details.

### "Not a database" or decryption errors

**Cause:** SQLCipher version mismatch or a corrupted database file.

**Fix:** Make sure you're using the reklawdbox binary (it bundles the correct SQLCipher version). If the database is corrupted, restore from Rekordbox's built-in backups:

- `master.backup.db`
- `master.backup2.db`
- `master.backup3.db`

These live in the same directory as `master.db`.

---

## Discogs authentication

### "Discogs auth is not configured"

**Cause:** `REKLAWDBOX_DISCOGS_BROKER_URL` is not set in your MCP host config.

**Fix:** Add both `REKLAWDBOX_DISCOGS_BROKER_URL` and `REKLAWDBOX_DISCOGS_BROKER_TOKEN` to your MCP config environment variables. See [Getting Started](/getting-started/) for the full config example.

### "Discogs sign-in is still pending"

**Cause:** The browser authorization flow was not completed.

**Fix:** Open the `auth_url` returned by the tool in your browser, approve the request on Discogs, then call `lookup_discogs` again.

### "Discogs broker session is missing or expired"

**Cause:** The session token expired or was rejected by the broker.

**Fix:** Call `lookup_discogs` again to start a new auth flow. If that still fails, do a hard reset:

<Steps>

1. Close the MCP host process (e.g., quit Claude Code or Claude Desktop).

2. Delete the internal database — or just the session table:

   ```bash
   # delete the whole file
   rm ~/Library/Application\ Support/reklawdbox/internal.sqlite3

   # or just clear the session table
   sqlite3 ~/Library/Application\ Support/reklawdbox/internal.sqlite3 \
     "DELETE FROM broker_discogs_session;"
   ```

3. Restart the MCP host.

4. Call `lookup_discogs` to start fresh authentication.

</Steps>

### "broker ... HTTP 401"

**Cause:** `REKLAWDBOX_DISCOGS_BROKER_TOKEN` does not match the token configured on the deployed broker.

**Fix:** Verify the token value in your MCP config matches what's set in the broker's Cloudflare Worker config. Copy-paste errors (trailing spaces, wrong quotes) are the most common cause.

### "broker ... HTTP 404/410"

**Cause:** The pending device flow expired before you completed browser authorization.

**Fix:** Call `lookup_discogs` again to start a new flow. Device flows are short-lived — complete the browser step promptly after receiving the URL.

---

## Essentia / audio analysis

### "Essentia not available" — tools only report stratum-dsp results

**Cause:** No Essentia installation found at either `CRATE_DIG_ESSENTIA_PYTHON` or the default venv path.

**Fix (option A):** Call the `setup_essentia` tool through your agent. It installs Essentia and activates it without a server restart.

**Fix (option B):** Install manually:

```bash
bash scripts/setup-essentia.sh
```

Then set `CRATE_DIG_ESSENTIA_PYTHON` to `~/.local/share/reklawdbox/essentia-venv/bin/python` in your MCP host config and restart the server.

### Essentia was working but stopped after a config change

**Cause:** The Essentia probe result is memoized for the process lifetime. Changing config alone does not trigger a re-probe.

**Fix:** Restart the MCP server after changing Essentia-related config. Alternatively, call the `setup_essentia` tool to force a re-probe without restarting.

### Audio analysis fails for specific tracks

**Cause:** Unsupported codec or a corrupted audio file.

**Fix:** Check that the file plays correctly in a regular audio player. reklawdbox supports these formats via symphonia: FLAC, MP3, WAV, M4A, AAC, and AIFF. Other formats (OGG, WMA) are not supported.

---

## XML import

### Tracks appear in Rekordbox but metadata didn't update

**Cause:** A long-standing Rekordbox reimport behavior (since RB 5.6.1) — existing tracks are not updated on a standard XML import.

**Fix:** Use the two-step import:

<Steps>

1. Right-click the imported playlist in Rekordbox and select **Import To Collection**.

2. Select all tracks in the playlist (Cmd+A), right-click, and select **Import To Collection** again. This forces Rekordbox to overwrite existing metadata with the values from the XML.

</Steps>

### Import fails with no error

**Cause:** The `<COLLECTION Entries="N">` count in the XML header doesn't match the actual number of tracks.

**Fix:** This should not happen with reklawdbox-generated XML. If it does, please [file a bug report](https://github.com/ryan-voitiskis/reklawdbox/issues).

### Tracks appear as missing/offline after import

**Cause:** File paths in the XML don't match actual file locations on disk.

**Fix:** This means the paths stored in the Rekordbox database are stale (files were moved or renamed after being added to Rekordbox). reklawdbox reads paths from the database — if the DB paths are wrong, the exported XML inherits those wrong paths. Fix the file locations in Rekordbox first, then re-export.

---

## MCP host connection

### Server doesn't start or immediately disconnects

**Cause:** Binary not found, wrong path in config, or missing execute permissions.

**Fix:** Verify the command path in your MCP config points to the built binary. Check it's executable:

```bash
chmod +x ./target/release/reklawdbox
```

### Tools are not visible in the MCP host

**Cause:** The server started but the host didn't enumerate tools correctly.

**Fix:** Remove and re-add the MCP server in your host config. For Claude Code:

```bash
claude mcp remove reklawdbox
claude mcp add reklawdbox -- ./target/release/reklawdbox
```

<Aside type="caution">
  Check for duplicate MCP registrations. Claude Code can have reklawdbox registered in both local scope (`~/.claude.json`) and project scope (`.mcp.json`). Local overrides project. Use `claude mcp list` to check.
</Aside>

### Slow tool responses

**Cause:** First-run audio analysis and enrichment are slow by nature. Analysis reads and decodes full audio files; enrichment calls external APIs.

**Fix:** This is expected behavior. Subsequent calls use the cache and return instantly. Use `skip_cached: true` (the default) to avoid re-analyzing tracks that already have results.

---

## General

### "No changes to write" when calling write_xml

**Cause:** No metadata changes have been staged.

**Fix:** Stage changes first with `update_tracks`, verify them with `preview_changes`, then call `write_xml`.

---

## Still stuck?

If your problem isn't listed here, check:

- [GitHub Issues](https://github.com/ryan-voitiskis/reklawdbox/issues) — for known bugs and feature requests
- [Environment Variables](/reference/environment-variables/) — for configuration reference
- [Getting Started](/getting-started/) — for initial setup walkthrough
